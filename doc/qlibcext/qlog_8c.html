<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-------------------------------------------------------------->
<!-- qLibc Project                                            -->
<!--                                                          -->
<!--            Copyright (c) The qDecoder Project            -->
<!--                 http://www.qdecoder.org                  -->
<!-------------------------------------------------------------->

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <title>qlibcext: extensions/qlog.c File Reference</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>

<body>
<center><h1>qLibc API Reference</h1></center>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>extensions/qlog.c File Reference</h1>  </div>
</div>
<div class="contents">
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Rotating file logger object. </p>
<p>qlog implements a auto-rotating file logger.</p>
<div class="fragment"><pre class="fragment">   <span class="comment">// create a daily-rotating log file.</span>
   qlog_t *log = <a class="code" href="qlog_8c.html#a2a82affc6321438612b5097a3e2cca98" title="Open ratating-log file.">qlog</a>(<span class="stringliteral">&quot;/tmp/dailylog-%Y%m%d.err&quot;</span>, 0644, 86400, <span class="keyword">false</span>);
   <span class="keywordflow">if</span>(log == NULL) <span class="keywordflow">return</span>;

   <span class="comment">// screen out.</span>
   log-&gt;duplicate(log, stdout, <span class="keyword">true</span>);

   <span class="comment">// write logs.</span>
   log-&gt;write(log, <span class="stringliteral">&quot;Service started.&quot;</span>);
   log-&gt;writef(log, <span class="stringliteral">&quot;Server Id: %d&quot;</span>, 1);

   <span class="comment">// close and release resources.</span>
   log-&gt;free(log);
</pre></div> <table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">qlog_t *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qlog_8c.html#a2a82affc6321438612b5097a3e2cca98">qlog</a> (const char *filepathfmt, mode_t mode, int rotateinterval, bool flush)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Open ratating-log file.  <a href="#a2a82affc6321438612b5097a3e2cca98"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qlog_8c.html#a1d9678a766dbbe0cf4863296588a70ce">write_</a> (qlog_t *log, const char *str)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">qlog-&gt;write(): Log messages  <a href="#a1d9678a766dbbe0cf4863296588a70ce"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qlog_8c.html#a0f1c08e4e0616731b8c5be87a8752f72">writef</a> (qlog_t *log, const char *format,...)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">qlog-&gt;<a class="el" href="qlog_8c.html#a0f1c08e4e0616731b8c5be87a8752f72" title="qlog-&gt;writef(): Log messages">writef()</a>: Log messages  <a href="#a0f1c08e4e0616731b8c5be87a8752f72"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qlog_8c.html#a3c66d4096cbaac34db4659e04a0d6335">duplicate</a> (qlog_t *log, FILE *outfp, bool flush)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">qlog-&gt;<a class="el" href="qlog_8c.html#a3c66d4096cbaac34db4659e04a0d6335" title="qlog-&gt;duplicate(): Duplicate log string into other stream">duplicate()</a>: Duplicate log string into other stream  <a href="#a3c66d4096cbaac34db4659e04a0d6335"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qlog_8c.html#a9753872b3edbc89389d22688fdc0afc2">flush_</a> (qlog_t *log)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">qlog-&gt;flush(): Flush buffered log  <a href="#a9753872b3edbc89389d22688fdc0afc2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qlog_8c.html#a58ed43ff476576586b46c4f6744f1fd2">free_</a> (qlog_t *log)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">qlog-&gt;free(): Close ratating-log file &amp; de-allocate resources  <a href="#a58ed43ff476576586b46c4f6744f1fd2"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a2a82affc6321438612b5097a3e2cca98"></a><!-- doxytag: member="qlog.c::qlog" ref="a2a82affc6321438612b5097a3e2cca98" args="(const char *filepathfmt, mode_t mode, int rotateinterval, bool flush)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">qlog_t* qlog </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>filepathfmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&nbsp;</td>
          <td class="paramname"> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rotateinterval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>flush</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Open ratating-log file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filepathfmt</em>&nbsp;</td><td>filename format. formatting argument is same as strftime() </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>new file mode. 0 for system default </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rotateinterval</em>&nbsp;</td><td>rotating interval seconds, set 0 to disable rotation </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flush</em>&nbsp;</td><td>set to true if you want to flush everytime logging. false for buffered logging</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer of qlog_t structure</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>rotateinterval is not relative time. If you set it to 3600, log file will be rotated at every hour. And filenameformat is same as strftime(). So If you want to log with hourly rotating, filenameformat must be defined including hour format like "/somepath/xxx-%Y%m%d%H.log". You can set it to "/somepath/xxx-%H.log" for daily overrided log file.</dd></dl>
<div class="fragment"><pre class="fragment">   qlog_t *log = <a class="code" href="qlog_8c.html#a2a82affc6321438612b5097a3e2cca98" title="Open ratating-log file.">qlog</a>(<span class="stringliteral">&quot;/tmp/qdecoder-%Y%m%d.err&quot;</span>, 0644, 86400, <span class="keyword">false</span>);
   log-&gt;free(log);
</pre></div><dl class="note"><dt><b>Note:</b></dt><dd>Use "--enable-threadsafe" configure script option to use under multi-threaded environments. </dd></dl>

</div>
</div>
<a class="anchor" id="a1d9678a766dbbe0cf4863296588a70ce"></a><!-- doxytag: member="qlog.c::write_" ref="a1d9678a766dbbe0cf4863296588a70ce" args="(qlog_t *log, const char *str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool write_ </td>
          <td>(</td>
          <td class="paramtype">qlog_t *&nbsp;</td>
          <td class="paramname"> <em>log</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>str</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>qlog-&gt;write(): Log messages </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>log</em>&nbsp;</td><td>a pointer of qlog_t </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>str</em>&nbsp;</td><td>message string</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if successful, otherewise returns false </dd></dl>

</div>
</div>
<a class="anchor" id="a0f1c08e4e0616731b8c5be87a8752f72"></a><!-- doxytag: member="qlog.c::writef" ref="a0f1c08e4e0616731b8c5be87a8752f72" args="(qlog_t *log, const char *format,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool writef </td>
          <td>(</td>
          <td class="paramtype">qlog_t *&nbsp;</td>
          <td class="paramname"> <em>log</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>qlog-&gt;<a class="el" href="qlog_8c.html#a0f1c08e4e0616731b8c5be87a8752f72" title="qlog-&gt;writef(): Log messages">writef()</a>: Log messages </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>log</em>&nbsp;</td><td>a pointer of qlog_t </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>format</em>&nbsp;</td><td>messages format</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if successful, otherewise returns false </dd></dl>

</div>
</div>
<a class="anchor" id="a3c66d4096cbaac34db4659e04a0d6335"></a><!-- doxytag: member="qlog.c::duplicate" ref="a3c66d4096cbaac34db4659e04a0d6335" args="(qlog_t *log, FILE *outfp, bool flush)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool duplicate </td>
          <td>(</td>
          <td class="paramtype">qlog_t *&nbsp;</td>
          <td class="paramname"> <em>log</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FILE *&nbsp;</td>
          <td class="paramname"> <em>outfp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>flush</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>qlog-&gt;<a class="el" href="qlog_8c.html#a3c66d4096cbaac34db4659e04a0d6335" title="qlog-&gt;duplicate(): Duplicate log string into other stream">duplicate()</a>: Duplicate log string into other stream </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>log</em>&nbsp;</td><td>a pointer of qlog_t </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fp</em>&nbsp;</td><td>logging messages will be printed out into this stream. set NULL to disable. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flush</em>&nbsp;</td><td>set to true if you want to flush everytime duplicating.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if successful, otherewise returns false</dd></dl>
<div class="fragment"><pre class="fragment">   log-&gt;duplicate(log, stdout, <span class="keyword">true</span>); <span class="comment">// enable console out with flushing</span>
   log-&gt;duplicate(log, stderr, <span class="keyword">false</span>);    <span class="comment">// enable console out</span>
   log-&gt;duplicate(log, NULL, <span class="keyword">false</span>);  <span class="comment">// disable console out (default)</span>
</pre></div> 
</div>
</div>
<a class="anchor" id="a9753872b3edbc89389d22688fdc0afc2"></a><!-- doxytag: member="qlog.c::flush_" ref="a9753872b3edbc89389d22688fdc0afc2" args="(qlog_t *log)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static bool flush_ </td>
          <td>(</td>
          <td class="paramtype">qlog_t *&nbsp;</td>
          <td class="paramname"> <em>log</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>qlog-&gt;flush(): Flush buffered log </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>log</em>&nbsp;</td><td>a pointer of qlog_t</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if successful, otherewise returns false </dd></dl>

</div>
</div>
<a class="anchor" id="a58ed43ff476576586b46c4f6744f1fd2"></a><!-- doxytag: member="qlog.c::free_" ref="a58ed43ff476576586b46c4f6744f1fd2" args="(qlog_t *log)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void free_ </td>
          <td>(</td>
          <td class="paramtype">qlog_t *&nbsp;</td>
          <td class="paramname"> <em>log</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>qlog-&gt;free(): Close ratating-log file &amp; de-allocate resources </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>log</em>&nbsp;</td><td>a pointer of qlog_t </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
<a href="http://www.qdecoder.org/">The qDecoder Project</a>.
Tue Jun 12 2012 07:35:13
</small></address>
</body>
</html>
