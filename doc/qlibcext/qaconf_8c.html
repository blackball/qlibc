<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-------------------------------------------------------------->
<!-- qLibc Project                                            -->
<!--                                                          -->
<!--            Copyright (c) The qDecoder Project            -->
<!--                 http://www.qdecoder.org                  -->
<!-------------------------------------------------------------->

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <title>qlibcext: extensions/qaconf.c File Reference</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>

<body>
<center><h1>qLibc API Reference</h1></center>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>extensions/qaconf.c File Reference</h1>  </div>
</div>
<div class="contents">
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Apache-style configuration file parser. </p>
<p>Apache-style Configuration is a configuration file syntax and format originally introduced by Apache HTTPd project. This format is power, versatile, flexible and human friendly.</p>
<p>Sample Apache-style Configuration Syntax: </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">   # Lines that begin with the hash character &quot;#&quot; are considered comments.</span>
<span class="preprocessor"></span>   Listen 53
   Protocols UDP TCP
   IPSEC On

   &lt;Domain <span class="stringliteral">&quot;qdecoder.org&quot;</span>&gt;
     TTL 86400
     MX 10 mail.qdecoder.org

     &lt;Host mail&gt;
        IPv4 192.168.10.1
        TXT <span class="stringliteral">&quot;US Rack-13D-18 \&quot;San Jose&#39;s\&quot;&quot;</span>
     &lt;/Host&gt;

     &lt;Host www&gt;
        IPv4 192.168.10.2
        TXT <span class="stringliteral">&#39;KR Rack-48H-31 &quot;Seoul\&#39;s&quot;&#39;</span>
        TTL 3600
     &lt;/Host&gt;
   &lt;/Domain&gt;

   &lt;Domain <span class="stringliteral">&quot;ringfs.org&quot;</span>&gt;
     &lt;Host www&gt;
        CNAME www.qdecoder.org
     &lt;/Host&gt;
   &lt;/Domain&gt;
</pre></div><div class="fragment"><pre class="fragment">   <span class="comment">// THIS EXAMPLE CODE CAN BE FOUND IN EXAMPLES DIRECTORY.</span>

   <span class="comment">// Define scope.</span>
   <span class="comment">//   QAC_SCOPE_ALL and QAC_SCOPE_ROOT are predefined.</span>
   <span class="comment">//   Custum scope should be defined from 2(1 &lt;&lt; 1).</span>
   <span class="comment">//   Note) These values are ORed(bit operation), so the number should be</span>
   <span class="comment">//         2(1&lt;&lt;1), 4(1&lt;&lt;2), 6(1&lt;&lt;3), 8(1&lt;&lt;4), ...</span>
   <span class="keyword">enum</span> {
     OPT_SECTION_ALL        = QAC_SECTION_ALL,   <span class="comment">// pre-defined</span>
     OPT_SECTION_ROOT       = QAC_SECTION_ROOT,  <span class="comment">// pre-defined</span>
     OPT_SECTION_DOMAIN     = (1 &lt;&lt; 1),    <span class="comment">// user-defined section</span>
     OPT_SECTION_HOST       = (1 &lt;&lt; 2),    <span class="comment">// user-defined section</span>
   };

   <span class="comment">// Define callback proto-types.</span>
   <span class="keyword">static</span> QAC_CB(confcb_debug);

   <span class="comment">// Define options and callbacks.</span>
   <span class="keyword">static</span> qaconf_option_t options[] = {
     {<span class="stringliteral">&quot;Listen&quot;</span>, QAC_TAKE_INT, confcb_debug, 0, OPT_SECTION_ALL},
     {<span class="stringliteral">&quot;Protocols&quot;</span>, QAC_TAKEALL, confcb_debug, 0, OPT_SECTION_ROOT},
     {<span class="stringliteral">&quot;IPSEC&quot;</span>, QAC_TAKE_BOOL, confcb_debug, 0, OPT_SECTION_ROOT},
     {<span class="stringliteral">&quot;Domain&quot;</span>, QAC_TAKE_STR, confcb_debug, OPT_SECTION_DOMAIN, OPT_SECTION_ROOT},
     {  <span class="stringliteral">&quot;TTL&quot;</span>, QAC_TAKE_INT, confcb_debug, 0, OPT_SECTION_DOMAIN | OPT_SECTION_HOST},
     {  <span class="stringliteral">&quot;MX&quot;</span>, QAC_TAKE2 | QAC_A1_INT, confcb_debug, 0, OPT_SECTION_DOMAIN},
     {  <span class="stringliteral">&quot;Host&quot;</span>, QAC_TAKE_STR, confcb_debug, OPT_SECTION_HOST, OPT_SECTION_DOMAIN},
     {    <span class="stringliteral">&quot;IPv4&quot;</span>, QAC_TAKE_STR, confcb_debug, 0, OPT_SECTION_HOST},
     {    <span class="stringliteral">&quot;TXT&quot;</span>, QAC_TAKE_STR, confcb_debug, 0, OPT_SECTION_HOST},
     {    <span class="stringliteral">&quot;CNAME&quot;</span>, QAC_TAKE_STR, confcb_debug, 0, OPT_SECTION_HOST},
     QAC_OPTION_END
   };

   <span class="keywordtype">int</span> user_main(<span class="keywordtype">void</span>)
   {
     <span class="comment">// Create a userdata structure.</span>
     <span class="keyword">struct </span>MyConf myconf;

     <span class="comment">// Initialize and create a qaconf object.</span>
     qaconf_t *conf = <a class="code" href="qaconf_8c.html#ac28c668ae735bb483d2c61c59f54cae0" title="Create a new configuration object.">qaconf</a>();
     <span class="keywordflow">if</span> (conf == NULL) {
       printf(<span class="stringliteral">&quot;Failed to open &#39;&quot;</span> CONF_PATH <span class="stringliteral">&quot;&#39;.\n&quot;</span>);
       <span class="keywordflow">return</span> -1;
     }

     <span class="comment">// Register options.</span>
     conf-&gt;addoptions(conf, options);

     <span class="comment">// Set callback userdata</span>
     <span class="comment">// This is a userdata which will be provided on callback</span>
     conf-&gt;setuserdata(conf, &amp;myconf);

     <span class="comment">// Run parser.</span>
     <span class="keywordtype">int</span> count = conf-&gt;parse(conf, CONF_PATH, QAC_CASEINSENSITIVE);
     <span class="keywordflow">if</span> (count &lt; 0) {
       printf(<span class="stringliteral">&quot;Error: %s\n&quot;</span>, conf-&gt;errmsg(conf));
     } <span class="keywordflow">else</span> {
       printf(<span class="stringliteral">&quot;Successfully loaded.\n&quot;</span>);
     }

     <span class="comment">// Verify userdata structure.</span>
     <span class="keywordflow">if</span> (conf-&gt;errmsg(conf) == NULL) {  <span class="comment">// another way to check parsing error.</span>
       <span class="comment">// codes here</span>
     }

     <span class="comment">// Release resources.</span>
     conf-&gt;free(conf);
   }

   <span class="keyword">static</span> QAC_CB(confcb_debug)
   {
     <span class="keywordtype">int</span> i;
     <span class="keywordflow">for</span> (i = 0; i &lt; data-&gt;level; i++) {
       printf (<span class="stringliteral">&quot;    &quot;</span>);
     }

     <span class="comment">// Print option name</span>
     <span class="keywordflow">if</span> (data-&gt;otype == QAC_OTYPE_SECTIONOPEN) {
       printf(<span class="stringliteral">&quot;&lt;%s&gt;&quot;</span>, data-&gt;argv[0]);
     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (data-&gt;otype == QAC_OTYPE_SECTIONCLOSE) {
       printf(<span class="stringliteral">&quot;&lt;/%s&gt;&quot;</span>, data-&gt;argv[0]);
     } <span class="keywordflow">else</span> {  <span class="comment">// This is QAC_OTYPE_OPTION type.</span>
       printf(<span class="stringliteral">&quot;%s&quot;</span>, data-&gt;argv[0]);
     }

     <span class="comment">// Print parent names</span>
     qaconf_cbdata_t *parent;
     <span class="keywordflow">for</span> (parent = data-&gt;parent; parent != NULL; parent = parent-&gt;parent) {
       printf(<span class="stringliteral">&quot; ::%s(%s)&quot;</span>, parent-&gt;argv[0], parent-&gt;argv[1]);
     }

     <span class="comment">// Print option arguments</span>
     <span class="keywordflow">for</span> (i = 1; i &lt; data-&gt;argc; i++) {
       printf(<span class="stringliteral">&quot; [%d:%s]&quot;</span>, i, data-&gt;argv[i]);
     }
     printf(<span class="stringliteral">&quot;\n&quot;</span>);

     <span class="comment">// Return OK</span>
     <span class="keywordflow">return</span> NULL;
   }
</pre></div><div class="fragment"><pre class="fragment">   [Output]
   Listen [1:53]
   Protocols [1:UDP] [2:TCP]
   IPSEC [1:1]
   &lt;Domain&gt; [1:qdecoder.org]
       TTL ::Domain(qdecoder.org) [1:86400]
       MX ::Domain(qdecoder.org) [1:10] [2:mail.qdecoder.org]
       &lt;Host&gt; ::Domain(qdecoder.org) [1:mail]
           IPv4 ::Host(mail) ::Domain(qdecoder.org) [1:192.168.10.1]
           TXT ::Host(mail) ::Domain(qdecoder.org) [1:US Rack-13D-18 <span class="stringliteral">&quot;San Jose&#39;s&quot;</span>]
       &lt;/Host&gt; ::Domain(qdecoder.org) [1:mail]
       &lt;Host&gt; ::Domain(qdecoder.org) [1:www]
           IPv4 ::Host(www) ::Domain(qdecoder.org) [1:192.168.10.2]
           TXT ::Host(www) ::Domain(qdecoder.org) [1:KR Rack-48H-31 <span class="stringliteral">&quot;Seoul&#39;s&quot;</span>]
           TTL ::Host(www) ::Domain(qdecoder.org) [1:3600]
       &lt;/Host&gt; ::Domain(qdecoder.org) [1:www]
   &lt;/Domain&gt; [1:qdecoder.org]
   &lt;Domain&gt; [1:ringfs.org]
       &lt;Host&gt; ::Domain(ringfs.org) [1:www]
           CNAME ::Host(www) ::Domain(ringfs.org) [1:www.qdecoder.org]
       &lt;/Host&gt; ::Domain(ringfs.org) [1:www]
   &lt;/Domain&gt; [1:ringfs.org]
   Successfully loaded.
</pre></div> <table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">qaconf_t *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qaconf_8c.html#ac28c668ae735bb483d2c61c59f54cae0">qaconf</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new configuration object.  <a href="#ac28c668ae735bb483d2c61c59f54cae0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qaconf_8c.html#a4b7d9693f31e326b134f03f8ee4bca09">addoptions</a> (qaconf_t *qaconf, const qaconf_option_t *options)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">qaconf_t-&gt;<a class="el" href="qaconf_8c.html#a4b7d9693f31e326b134f03f8ee4bca09" title="qaconf_t-&gt;addoptions(): Register option directives.">addoptions()</a>: Register option directives.  <a href="#a4b7d9693f31e326b134f03f8ee4bca09"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qaconf_8c.html#a8b3550a34ca912712a7ee45bf2d1d032">setdefhandler</a> (qaconf_t *qaconf, const qaconf_cb_t *callback)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set default callback function.  <a href="#a8b3550a34ca912712a7ee45bf2d1d032"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qaconf_8c.html#ab68c8ab80781fbca3aeaf7e3d16a9cc2">setuserdata</a> (qaconf_t *qaconf, const void *userdata)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">qaconf_t-&gt;<a class="el" href="qaconf_8c.html#ab68c8ab80781fbca3aeaf7e3d16a9cc2" title="qaconf_t-&gt;setuserdata(): Set userdata which will be provided on callback.">setuserdata()</a>: Set userdata which will be provided on callback.  <a href="#ab68c8ab80781fbca3aeaf7e3d16a9cc2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qaconf_8c.html#a1ee9ebbb7719b530a788d2d01256b2cc">parse</a> (qaconf_t *qaconf, const char *filepath, uint8_t flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">qaconf_t-&gt;<a class="el" href="qaconf_8c.html#a1ee9ebbb7719b530a788d2d01256b2cc" title="qaconf_t-&gt;parse(): Run parser.">parse()</a>: Run parser.  <a href="#a1ee9ebbb7719b530a788d2d01256b2cc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qaconf_8c.html#a5c09256d455a4cf7443aca42bccdf0e0">errmsg</a> (qaconf_t *qaconf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">qaconf_t-&gt;<a class="el" href="qaconf_8c.html#a5c09256d455a4cf7443aca42bccdf0e0" title="qaconf_t-&gt;errmsg(): Get last error message.">errmsg()</a>: Get last error message.  <a href="#a5c09256d455a4cf7443aca42bccdf0e0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qaconf_8c.html#abad17eff2cc816719fdba22f271b0aab">reseterror</a> (qaconf_t *qaconf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">qaconf_t-&gt;<a class="el" href="qaconf_8c.html#abad17eff2cc816719fdba22f271b0aab" title="qaconf_t-&gt;reseterror(): Clear error message.">reseterror()</a>: Clear error message.  <a href="#abad17eff2cc816719fdba22f271b0aab"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qaconf_8c.html#abfcdc4a8d1067527f4c2d99b29d0db39">free_</a> (qaconf_t *qaconf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">qaconf_t-&gt;free(): Release resources.  <a href="#abfcdc4a8d1067527f4c2d99b29d0db39"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ac28c668ae735bb483d2c61c59f54cae0"></a><!-- doxytag: member="qaconf.c::qaconf" ref="ac28c668ae735bb483d2c61c59f54cae0" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">qaconf_t* qaconf </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a new configuration object. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer of new qaconf_t object.</dd></dl>
<div class="fragment"><pre class="fragment">   qaconf_t *conf = <a class="code" href="qaconf_8c.html#ac28c668ae735bb483d2c61c59f54cae0" title="Create a new configuration object.">qaconf</a>();
   <span class="keywordflow">if</span> (conf == NULL) {
     <span class="comment">// Insufficient memory.</span>
   }
</pre></div> 
</div>
</div>
<a class="anchor" id="a4b7d9693f31e326b134f03f8ee4bca09"></a><!-- doxytag: member="qaconf.c::addoptions" ref="a4b7d9693f31e326b134f03f8ee4bca09" args="(qaconf_t *qaconf, const qaconf_option_t *options)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int addoptions </td>
          <td>(</td>
          <td class="paramtype">qaconf_t *&nbsp;</td>
          <td class="paramname"> <em>qaconf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const qaconf_option_t *&nbsp;</td>
          <td class="paramname"> <em>options</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>qaconf_t-&gt;<a class="el" href="qaconf_8c.html#a4b7d9693f31e326b134f03f8ee4bca09" title="qaconf_t-&gt;addoptions(): Register option directives.">addoptions()</a>: Register option directives. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>qaconf</em>&nbsp;</td><td>qaconf_t object. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>options</em>&nbsp;</td><td>array pointer of qaconf_option_t.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a number of options registered(added).</dd></dl>
<div class="fragment"><pre class="fragment">  qaconf_option_t options[] = {
     {<span class="stringliteral">&quot;Listen&quot;</span>, QAC_TAKE_INT, confcb_debug, 0, OPT_SECTION_ALL},
     {<span class="stringliteral">&quot;Protocols&quot;</span>, QAC_TAKEALL, confcb_debug, 0, OPT_SECTION_ROOT},
     {<span class="stringliteral">&quot;IPSEC&quot;</span>, QAC_TAKE_BOOL, confcb_debug, 0, OPT_SECTION_ROOT},
     {<span class="stringliteral">&quot;Domain&quot;</span>, QAC_TAKE_STR, confcb_debug, OPT_SECTION_DOMAIN, OPT_SECTION_ROOT},
     {  <span class="stringliteral">&quot;TTL&quot;</span>, QAC_TAKE_INT, confcb_debug, 0, OPT_SECTION_DOMAIN | OPT_SECTION_HOST},
     {  <span class="stringliteral">&quot;MX&quot;</span>, QAC_TAKE2 | QAC_A1_INT, confcb_debug, 0, OPT_SECTION_DOMAIN},
     {  <span class="stringliteral">&quot;Host&quot;</span>, QAC_TAKE_STR, confcb_debug, OPT_SECTION_HOST, OPT_SECTION_DOMAIN},
     {    <span class="stringliteral">&quot;IPv4&quot;</span>, QAC_TAKE_STR, confcb_debug, 0, OPT_SECTION_HOST},
     {    <span class="stringliteral">&quot;TXT&quot;</span>, QAC_TAKE_STR, confcb_debug, 0, OPT_SECTION_HOST},
     {    <span class="stringliteral">&quot;CNAME&quot;</span>, QAC_TAKE_STR, confcb_debug, 0, OPT_SECTION_HOST},
     QAC_OPTION_END
   };

   <span class="comment">// Register options.</span>
   qaconf_t *conf = <a class="code" href="qaconf_8c.html#ac28c668ae735bb483d2c61c59f54cae0" title="Create a new configuration object.">qaconf</a>();
   conf-&gt;addoptions(conf, options);
   (...codes goes...)
</pre></div><p>It takes an array of options as provided in the sample codes. Each option consists of 5 parameters as below</p>
<div class="fragment"><pre class="fragment">   1st) Option Name : A option directive name.
   2nd) Arguments   : A number of arguments <span class="keyword">this</span> option takes and their types.
   3rd) Callback    : A function pointer <span class="keywordflow">for</span> callback.
   4th) Section ID  : Section ID <span class="keywordflow">if</span> <span class="keyword">this</span> option is a section like &lt;Option&gt;.
                 Otherwise 0 <span class="keywordflow">for</span> regular option.
   5th) Sections    : ORed section IDs where <span class="keyword">this</span> option can be specified.
</pre></div><p>Example:</p>
<div class="fragment"><pre class="fragment"> {<span class="stringliteral">&quot;TTL&quot;</span>, QAC_TAKE_INT, confcb_debug, 0, OPT_SECTION_DOMAIN | OPT_SECTION_HOST}
   1st) Option name is <span class="stringliteral">&quot;TTL&quot;</span>
   2nd) It takes 1 argument and its type must be integer.
   3rd) Callback function, confcb_debug, will be called.
   4th) This is a regular option and does not have section <span class="keywordtype">id</span>.
   5th) This option can be specified in OPT_SECTION_DOMAIN and OPT_SECTION_HOST.
</pre></div><p>OPTION NAME field:</p>
<p>Option name is a unique string. Even an option is section type like &lt;option&gt; only name part without bracket needs to be specifed.</p>
<p>ARGUMENT field:</p>
<p>This field is for providing argument checking in parser level. So in user's callback routine can go simple. This provides checking of number of arguments this option can take and those argument type.</p>
<p>In terms of argument types. There are 4 argument types as below. And first 5 arguments can be checked individually with different types.</p>
<div class="fragment"><pre class="fragment">   STR type   : any type
   INT type   : integer type. ex) 23, -12, 0
   FLOAT type : integer + floating point type. ex) 1.32, -32.5, 23, -12, 0
   BOOL type  : <span class="keywordtype">bool</span> type ex) 1/0, <span class="keyword">true</span>/<span class="keyword">false</span>, on/off, yes/no
</pre></div><p>When a BOOL type is specified, the argument passed to callback will be replaced to "1" or "0" for convenience use. For example, if "On" is specified as a argument and if BOOL type checking is specified, then actual argument which will be passed to callback will have "1". So we can simply determine it like "bool enabled = atoi(data-&gt;argv[1])".</p>
<p>If original input argument needs to be passed to callback, specify STR type.</p>
<p>Here is some examples of how to specify "Arguments" field.</p>
<div class="fragment"><pre class="fragment">  An option takes 1 argument.
    QAC_TAKE_STR    &lt;= String(any) type
    QAC_TAKE_INT    &lt;= Integer type
    QAC_TAKE_FLOAT  &lt;= Float type
    QAC_TAKE_BOOL   &lt;= Bool type

    QAC_TAKE1               &lt;= Equavalent to QAC_TAKE_STR
    QAC_TAKE1 | QAC_A1_BOOL &lt;= Equavalent to QAC_TAKE_BOOL

  An option takes 2 arguments, <span class="keywordtype">bool</span> and <span class="keywordtype">float</span>.
    QAC_TAKE2 | QAC_A1_BOOL | QAC_A2_FLOAT

  An option takes any number of arguments in any type.
    QAC_TAKEALL

  An option takes any number of arguments but 1st one must be <span class="keywordtype">bool</span> and
  2nd one must be integer and rest of them must be <span class="keywordtype">float</span>.
    QAC_TAKEALL | QAC_A1_BOOL | QAC_A2_INT | QAC_AA_FLOAT
</pre></div><p>CALLBACK field:</p>
<p>User defined callback function. We provide a macro, QAC_CB, for function proto type. Always use QAC_CB macro.</p>
<div class="fragment"><pre class="fragment">   QAC_CB(sample_cb) {
     (...codes...)
   }

   is equavalent to

   <span class="keywordtype">char</span> *sample_cb(qaconf_cbdata_t *data, <span class="keywordtype">void</span> *userdata) {
     (...codes...)
   }
</pre></div><p>Callback function will be called with 2 arguments. One is callback data and the other one is userdata. Userdata is the data pointer set by <a class="el" href="qaconf_8c.html#ab68c8ab80781fbca3aeaf7e3d16a9cc2" title="qaconf_t-&gt;setuserdata(): Set userdata which will be provided on callback.">setuserdata()</a>.</p>
<p>Here is data structure. Arguments belong to the option can be accessed via argv variables like data-&gt;argv[1]. argv[0] is for the option name.</p>
<div class="fragment"><pre class="fragment">   <span class="keyword">struct </span>qaconf_cbdata_s {
     <span class="keyword">enum</span> qaconf_otype otype;  <span class="comment">// option type</span>
     uint64_t section;         <span class="comment">// current section where this option is located</span>
     uint64_t sections;        <span class="comment">// ORed all parent&#39;s sectionid(s) including current sections</span>
     uint8_t level;            <span class="comment">// number of parents(level), root level is 0</span>
     qaconf_cbdata_t *parent;  <span class="comment">// upper parent link</span>

     <span class="keywordtype">int</span> argc;       <span class="comment">// number arguments. always equal or greater than 1.</span>
     <span class="keywordtype">char</span> **argv;    <span class="comment">// argument pointers. argv[0] is option name.</span>
   }
</pre></div><p>SECTION ID field:</p>
<p>If an option is an section like &lt;Option&gt;, section id can be assigned. This section id can be used to limit some other option directives to be located only inside of that section. So this is your choice. If it doesn't require to check directory scope, we can just specify 0 here.</p>
<p>There are 2 pre-defined section id, QAC_SECTION_ALL and QAC_SECTION_ROOT. When we define user section, it has to be defined from 2(1 &lt;&lt; 1)as below.</p>
<div class="fragment"><pre class="fragment">   <span class="keyword">enum</span> {
     OPT_SECTION_ALL        = QAC_SECTION_ALL,   <span class="comment">// pre-defined</span>
     OPT_SECTION_ROOT       = QAC_SECTION_ROOT,  <span class="comment">// pre-defined</span>
     OPT_SECTION_DOMAIN     = (1 &lt;&lt; 1),    <span class="comment">// user-defined section</span>
     OPT_SECTION_HOST       = (1 &lt;&lt; 2),    <span class="comment">// user-defined section</span>
   };
</pre></div><p>Please note that this section IDs are ORed. So the section id should be assigned in bit operation manner as 2(1&lt;&lt;1), 4(1&lt;&lt;2), 6(1&lt;&lt;3), 8(1&lt;&lt;4), ...</p>
<p>SECTION IDS field:</p>
<p>This field is to limit the scope where an option is allowed to be specified. Multiple section IDs can be ORed.</p>
<p>QAC_SECTION_ALL means an option can be appeared in anywhere.</p>
<p>QAC_SECTION_ROOT means an option can be appeared only in top level and not inside of any sections. </p>

</div>
</div>
<a class="anchor" id="a8b3550a34ca912712a7ee45bf2d1d032"></a><!-- doxytag: member="qaconf.c::setdefhandler" ref="a8b3550a34ca912712a7ee45bf2d1d032" args="(qaconf_t *qaconf, const qaconf_cb_t *callback)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setdefhandler </td>
          <td>(</td>
          <td class="paramtype">qaconf_t *&nbsp;</td>
          <td class="paramname"> <em>qaconf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const qaconf_cb_t *&nbsp;</td>
          <td class="paramname"> <em>callback</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set default callback function. </p>
<p>Default callback function will be called for unregistered option directives. QAC_IGNOREUNKNOWN flag will be ignored when default callback has set.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>qaconf</em>&nbsp;</td><td>qaconf_t object. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callback</em>&nbsp;</td><td>callback function pointer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ab68c8ab80781fbca3aeaf7e3d16a9cc2"></a><!-- doxytag: member="qaconf.c::setuserdata" ref="ab68c8ab80781fbca3aeaf7e3d16a9cc2" args="(qaconf_t *qaconf, const void *userdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void setuserdata </td>
          <td>(</td>
          <td class="paramtype">qaconf_t *&nbsp;</td>
          <td class="paramname"> <em>qaconf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>userdata</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>qaconf_t-&gt;<a class="el" href="qaconf_8c.html#ab68c8ab80781fbca3aeaf7e3d16a9cc2" title="qaconf_t-&gt;setuserdata(): Set userdata which will be provided on callback.">setuserdata()</a>: Set userdata which will be provided on callback. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>qaconf</em>&nbsp;</td><td>qaconf_t object. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>userdata</em>&nbsp;</td><td>a pointer of userdata.</td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><pre class="fragment">   <span class="comment">// Define an example userdata</span>
   <span class="keyword">struct </span>MyConf {
     <span class="keywordtype">int</span> sample;
   };

   <span class="keywordtype">int</span> user_main(<span class="keywordtype">void</span>) {
     <span class="keyword">struct </span>MyConf myconf;

     (...codes...)

     <span class="comment">// Set callback userdata.</span>
     conf-&gt;<a class="code" href="qaconf_8c.html#ab68c8ab80781fbca3aeaf7e3d16a9cc2" title="qaconf_t-&amp;gt;setuserdata(): Set userdata which will be provided on callback.">setuserdata</a>(conf, &amp;myconf);
     (...codes...)
    }

   QAC_CB(confcb_callback_func) {
     (...codes...)
      <span class="comment">// Type casting userdata for convenient use.</span>
      <span class="keyword">struct </span>MyConf *myconf = (<span class="keyword">struct </span>MyConf *)userdata;
      myconf-&gt;sample++;
     (...codes...)
     <span class="keywordflow">return</span> NULL;
   }
</pre></div> 
</div>
</div>
<a class="anchor" id="a1ee9ebbb7719b530a788d2d01256b2cc"></a><!-- doxytag: member="qaconf.c::parse" ref="a1ee9ebbb7719b530a788d2d01256b2cc" args="(qaconf_t *qaconf, const char *filepath, uint8_t flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int parse </td>
          <td>(</td>
          <td class="paramtype">qaconf_t *&nbsp;</td>
          <td class="paramname"> <em>qaconf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>filepath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>qaconf_t-&gt;<a class="el" href="qaconf_8c.html#a1ee9ebbb7719b530a788d2d01256b2cc" title="qaconf_t-&gt;parse(): Run parser.">parse()</a>: Run parser. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>qaconf</em>&nbsp;</td><td>qaconf_t object. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filepath</em>&nbsp;</td><td>configuration file path. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>parser options. (0 for default)</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A number of option directives parsed. -1 will be returned in case of error.</dd></dl>
<p>Here is a list of flags. Multiple flags can be ORed.</p>
<p>QAC_CASEINSENSITIVE: Option name is case-insensitive.</p>
<p>QAC_IGNOREUNKNOWN : Ignore unknown option directives. This flag will be ignored if <a class="el" href="qaconf_8c.html#a8b3550a34ca912712a7ee45bf2d1d032" title="Set default callback function.">setdefhandler()</a> has set.</p>
<div class="fragment"><pre class="fragment">   <span class="keywordtype">int</span> c;
   c = conf-&gt;parse(conf, <span class="stringliteral">&quot;sm1.conf&quot;</span>, 0);
   c = conf-&gt;parse(conf, <span class="stringliteral">&quot;sm2.conf&quot;</span>, QAC_CASEINSENSITIVE);
   c = conf-&gt;parse(conf, <span class="stringliteral">&quot;sm3.conf&quot;</span>, QAC_CASEINSENSITIVE | QAC_IGNOREUNKNOWN);
</pre></div> 
</div>
</div>
<a class="anchor" id="a5c09256d455a4cf7443aca42bccdf0e0"></a><!-- doxytag: member="qaconf.c::errmsg" ref="a5c09256d455a4cf7443aca42bccdf0e0" args="(qaconf_t *qaconf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static const char* errmsg </td>
          <td>(</td>
          <td class="paramtype">qaconf_t *&nbsp;</td>
          <td class="paramname"> <em>qaconf</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>qaconf_t-&gt;<a class="el" href="qaconf_8c.html#a5c09256d455a4cf7443aca42bccdf0e0" title="qaconf_t-&gt;errmsg(): Get last error message.">errmsg()</a>: Get last error message. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>qaconf</em>&nbsp;</td><td>qaconf_t object.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A const pointer of error message string.</dd></dl>
<div class="fragment"><pre class="fragment">   <span class="keywordtype">int</span> c = conf-&gt;parse(conf, <span class="stringliteral">&quot;sample.conf&quot;</span>, 0);
   <span class="keywordflow">if</span> (c &lt; 0) {
     <span class="comment">// ERROR</span>
     printf(<span class="stringliteral">&quot;%s\n&quot;</span>, conf-&gt;errmsg(conf));
   }
</pre></div> 
</div>
</div>
<a class="anchor" id="abad17eff2cc816719fdba22f271b0aab"></a><!-- doxytag: member="qaconf.c::reseterror" ref="abad17eff2cc816719fdba22f271b0aab" args="(qaconf_t *qaconf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void reseterror </td>
          <td>(</td>
          <td class="paramtype">qaconf_t *&nbsp;</td>
          <td class="paramname"> <em>qaconf</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>qaconf_t-&gt;<a class="el" href="qaconf_8c.html#abad17eff2cc816719fdba22f271b0aab" title="qaconf_t-&gt;reseterror(): Clear error message.">reseterror()</a>: Clear error message. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>qaconf</em>&nbsp;</td><td>qaconf_t object.</td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><pre class="fragment">   conf-&gt;reseterror(conf);
   conf-&gt;parse(conf, <span class="stringliteral">&quot;sample.conf&quot;</span>, 0);
   <span class="keywordflow">if</span> (conf-&gt;errmsg(conf) != NULL) {
     <span class="comment">// ERROR</span>
   }
</pre></div> 
</div>
</div>
<a class="anchor" id="abfcdc4a8d1067527f4c2d99b29d0db39"></a><!-- doxytag: member="qaconf.c::free_" ref="abfcdc4a8d1067527f4c2d99b29d0db39" args="(qaconf_t *qaconf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void free_ </td>
          <td>(</td>
          <td class="paramtype">qaconf_t *&nbsp;</td>
          <td class="paramname"> <em>qaconf</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>qaconf_t-&gt;free(): Release resources. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>qaconf</em>&nbsp;</td><td>qaconf_t object.</td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><pre class="fragment">   conf-&gt;free(conf);
</pre></div> 
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
<a href="http://www.qdecoder.org/">The qDecoder Project</a>.
Tue Jun 12 2012 07:35:13
</small></address>
</body>
</html>
